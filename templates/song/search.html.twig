{% extends 'base.html.twig' %}

{% block title %}Hello SongController!{% endblock %}

{% block stylesheets %}
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        body {
            background: linear-gradient(to right, #1db954, #191414);
            color: white;
            height: 100vh;
        }

        .example-wrapper {
            margin: 0.5em auto;
            max-width: 800px;
            width: 95%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .form-group {
            width: 100%;
            margin-bottom: 20px;
        }

        .form-control {
            border-radius: 20px;
            padding: 15px 30px;
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.6);
            transition: border 0.3s;
            font-size: 1.2rem; /* Augmente la taille de la police */
        }

        .form-control:focus {
            border-color: #1db954;
            box-shadow: 0 0 5px rgba(29, 185, 84, 0.5);
            outline: none;
        }

        .button-92 {
            --c: #fff;
            background: linear-gradient(90deg, #0000 33%, #fff5, #0000 67%) var(--_p, 100%)/300% no-repeat,
            #1db954;
            color: #fff; /* Met le texte en blanc */
            border: none;
            font-size: 1.5rem;
            padding: 0.8em 1.5em;
            border-radius: 20px;
            cursor: pointer;
            transition: 0.3s;
            margin: 0 10px; /* Ajoute un espace entre les boutons */
        }

        .button-92:hover {
            --_p: 0%;
        }

        .submit-button {
            border-radius: 20px;
            padding: 15px 30px;
            background-color: #1db954; /* Couleur du bouton */
            color: white; /* Couleur du texte */
            border: none;
            font-size: 1.2rem; /* Taille de la police */
            transition: background-color 0.3s;
            cursor: pointer;
        }

        .submit-button:hover {
            background-color: #159a43; /* Couleur du bouton au survol */
        }

        h1 {
            margin-bottom: 30px;
            font-size: 2rem;
            text-align: center;
        }

        .card {
            background-color: #282828; /* Fond sombre pour la carte */
            border: none; /* Pas de bordure */
            border-radius: 12px; /* Coins arrondis */
            transition: transform 0.3s, box-shadow 0.3s; /* Ajout d'un effet de survol */
        }

        .card:hover {
            transform: scale(1.05); /* Légère augmentation de taille au survol */
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3); /* Ombre pour le relief */
        }

        .card-img-top {
            border-top-left-radius: 12px; /* Coins arrondis */
            border-top-right-radius: 12px; /* Coins arrondis */
        }

        .heart {
            position: absolute;
            top: 10px;
            right: 10px;
            color: white; /* Couleur du cœur */
            cursor: pointer; /* Curseur pointer pour le cœur */
            font-size: 1.5rem; /* Taille de l'icône du cœur */
        }

        .card-title {
            color: #1db954; /* Couleur du titre */
        }

        .card-text {
            color: #b3b3b3; /* Couleur des textes */
        }

        .button-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px; /* Espace en bas des boutons */
        }
    </style>
{% endblock %}

{% block javascripts %}
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        function toggleFavorite(url) {
            fetch(url)
                .then(response => {
                    if (response.ok) {
                        window.location.reload();
                    } else {
                        console.error('Erreur lors de la mise à jour des favoris');
                    }
                })
                .catch(error => console.error('Erreur:', error));
        }
    </script>
{% endblock %}

{% block body %}
    <div class="container">
        <h1 class="my-4 text-center">Search for Tracks</h1>

        <div class="example-wrapper">
            <div class="form-group">
                {{ form_start(form, {'attr': {'class': 'form'}}) }}
                {{ form_row(form.search, {'attr': {'class': 'form-control', 'placeholder': 'Search for a track'}}) }}
                <button type="submit" class="submit-button">Search</button>
                {{ form_end(form) }}
            </div>

            <div class="button-container">
                <button class="button-92" onclick="window.location.href = '{{ path('app_login') }}';">
                    {% if app.user %}
                        Logout
                    {% else %}
                        Login
                    {% endif %}
                </button>

                {% if app.user %}
                    <button class="button-92" onclick="window.location.href = '{{ path('app_personnal_favorite') }}';">
                        Favorite
                    </button>
                {% endif %}
            </div>
        </div>

        <!-- Résultats de recherche -->
        <div class="row mt-4">
            {% if tracks is defined and tracks is not empty and tracks is not null %}
                {% for track in tracks %}
                    <div class="col-md-4 mb-4">
                        <div class="card h-100 shadow-sm">
                            <img src="{{ track.pictureLink }}" class="card-img-top" alt="{{ track.albumname }}" style="height: 200px; object-fit: cover; border-radius: 12px;">

                            <div class="heart" onclick="toggleFavorite('{{ path('app_favorite', {'id': track.idspotify}) }}');">
                                {% if track.isFavorite %}
                                    <i class="fas fa-heart"></i> <!-- Cœur plein -->
                                {% else %}
                                    <i class="far fa-heart"></i> <!-- Cœur vide -->
                                {% endif %}
                            </div>

                            <div class="card-body text-center" style="padding: 20px;">
                                <h5 class="card-title">{{ track.name }}</h5>
                                <p class="card-text">Artist: {{ track.artists }}</p>
                                <p class="card-text">Album: {{ track.albumname }}</p>
                            </div>

                            <div class="card-footer text-center" style="background-color: #191414; border-top: none;">
                                <button class="btn btn-outline-light"
                                        onclick="window.location.href = '{{ path('app_songdetail', {'id': track.idspotify}) }}';"
                                        style="border-radius: 20px; width: 100%;">Details</button>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <div class="col-12">
                    <h2 class="text-center">No track found</h2>
                </div>
            {% endif %}
        </div>

    </div>
{% endblock %}
